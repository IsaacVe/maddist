!function(){"use strict";var n,t,o=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=function(n){return function(t){return typeof t===n}},e=function(n){return o=typeof(t=n),"string"===(null===t?"null":"object"===o&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===o&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":o);var t,o},i=r("boolean"),u=r("number"),c=function(n){return function(){return n}},a=c(!1),s=c(!0),f=function(){return l},l={fold:function(n,t){return n()},isSome:a,isNone:s,getOr:t=function(n){return n},getOrThunk:n=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:c(null),getOrUndefined:c(void 0),or:t,orThunk:n,map:f,each:function(){},bind:f,exists:a,forall:s,filter:function(){return f()},toArray:function(){return[]},toString:c("none()")},d=function(n,t){for(var o=0,r=n.length;o<r;o++)t(n[o],o)},v=Object.keys,m=function(n,t){for(var o=v(n),r=0,e=o.length;r<e;r++){var i=o[r];t(n[i],i)}};"undefined"!=typeof window?window:Function("return this;")();var g=function(n){return n.dom.nodeValue},h=function(n){return 3===function(n){return n.dom.nodeType}(n)},p=function(n,t,o){!function(n,t,o){if(!(e(o)||i(o)||u(o)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",o,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,o+"")}(n.dom,t,o)},y=function(n,t){n.dom.removeAttribute(t)},b=function(n,t){var o=function(n,t){var o=n.dom.getAttribute(t);return null===o?void 0:o}(n,t);return void 0===o||""===o?[]:o.split(" ")},w=function(n){return void 0!==n.dom.classList},k=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:n}},A=k,C={" ":"nbsp","­":"shy"},N=function(n,t){var o="";return m(n,(function(n,t){o+=t})),new RegExp("["+o+"]",t?"g":"")},O=N(C),T=N(C,!0),S=function(n){var t="";return m(n,(function(n){t&&(t+=","),t+="span.mce-"+n})),t}(C),B="mce-nbsp",V=function(n){return'<span data-mce-bogus="1" class="mce-'+C[n]+'">'+n+"</span>"},E=function(n){var t=g(n);return h(n)&&void 0!==t&&O.test(t)},L=function(n,t){var o=[],r=function(n,t){for(var o=n.length,r=new Array(o),e=0;e<o;e++){var i=n[e];r[e]=t(i,e)}return r}(n.dom.childNodes,A);return d(r,(function(n){t(n)&&(o=o.concat([n])),o=o.concat(L(n,t))})),o},j=function(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")},P=function(n,t){var o=L(A(t),E);d(o,(function(t){var o,r,e=t.dom.parentNode;if(j(e))o=A(e),r=B,w(o)?o.dom.classList.add(r):function(n,t){(function(n,t,o){var r=b(n,t).concat([o]);p(n,t,r.join(" "))})(n,"class",t)}(o,r);else{for(var i=n.dom.encode(g(t)).replace(T,V),u=n.dom.create("div",null,i),c=void 0;c=u.lastChild;)n.dom.insertAfter(c,t.dom);n.dom.remove(t.dom)}}))},x=function(n,t){var o=n.dom.select(S,t);d(o,(function(t){var o,r;j(t)?(o=A(t),r=B,w(o)?o.dom.classList.remove(r):function(n,t){(function(n,t,o){var r=function(n,t){for(var r=[],e=0,i=n.length;e<i;e++){var u=n[e];u!==o&&r.push(u)}return r}(b(n,t));r.length>0?p(n,t,r.join(" ")):y(n,t)})(n,"class",t)}(o,r),function(n){var t=w(n)?n.dom.classList:function(n){return b(n,"class")}(n);0===t.length&&y(n,"class")}(o)):n.dom.remove(t,!0)}))},_=function(n){var t=n.getBody(),o=n.selection.getBookmark(),r=function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}}(n.selection.getNode(),t);x(n,r=void 0!==r?r:t),P(n,r),n.selection.moveToBookmark(o)},D=function(n,t){!function(n,t){n.fire("VisualChars",{state:t})}(n,t.get());var o=n.getBody();!0===t.get()?P(n,o):x(n,o)},I=tinymce.util.Tools.resolve("tinymce.util.Delay"),M=function(n,t){return function(o){o.setActive(t.get());var r=function(n){return o.setActive(n.state)};return n.on("VisualChars",r),function(){return n.off("VisualChars",r)}}};o.add("visualchars",(function(n){var t=function(n){var t=n;return{get:function(){return t},set:function(n){t=n}}}(function(n){return n.getParam("visualchars_default_state",!1)}(n));return function(n,t){n.addCommand("mceVisualChars",(function(){!function(n,t){t.set(!t.get());var o=n.selection.getBookmark();D(n,t),n.selection.moveToBookmark(o)}(n,t)}))}(n,t),function(n,t){var o=function(){return n.execCommand("mceVisualChars")};n.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:M(n,t)}),n.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:M(n,t)})}(n,t),function(n,t){var o=I.debounce((function(){_(n)}),300);(function(n){return!1!==n.getParam("forced_root_block")})(n)&&n.on("keydown",(function(r){!0===t.get()&&(13===r.keyCode?_(n):o())})),n.on("remove",o.stop)}(n,t),function(n,t){n.on("init",(function(){D(n,t)}))}(n,t),function(n){return{isEnabled:function(){return n.get()}}}(t)}))}();